<div class="card calendar-card">
    <h2><i class="bi bi-calendar"></i> Calendar - <span id="calendar-month"></span></h2>
    <div class="calendar-grid">
        <% 
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();

        // Empty cells before the first day
        for (let i = 0; i < firstDay; i++) { %>
            <div class="calendar-day empty"></div>
        <% } %>

        <% for (let day = 1; day <= daysInMonth; day++) { 
            let fullDate = new Date(currentYear, currentMonth, day).toDateString();
        %>
            <div class="calendar-day">
                <span class="day-label"><%= day %></span>
                <div class="calendar-events">
                    <% if (eventsByDay[fullDate]) { %>
                        <% eventsByDay[fullDate].forEach(event => { 
                            let planType = event.planType || "unknown";
                        %>
                            <div class="calendar-event border-<%= planType %>" data-plan-type="<%= planType %>" data-debug="<%= event.subject %> | Plan: <%= planType %>">

                                <%= event.subject %> - 
                                <%= new Date(event.start.dateTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) %>
                            </div>
                        <% }) %>
                    <% } %>
                </div>
            </div>
        <% } %>
    </div>
</div>
